{% extends "base.html" %}

{% block title %}å»ºç«‹ç¹³æ¬¾ç´€éŒ„{% endblock %}

{% block content %}
<div style="max-width: 600px; margin: 0 auto;">
    <div class="card">
        <h2 class="card-title">ğŸ’° å»ºç«‹ç¹³æ¬¾ç´€éŒ„</h2>

        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
            <p><strong>æ“ä½œå“¡ï¼š</strong>{{ operator.full_name }}</p>
            <p><strong>æœŸé–“ï¼š</strong>{{ summary.period_start.strftime('%Y/%m/%d') }} ~ {{ summary.period_end.strftime('%Y/%m/%d') }}</p>
            <p><strong>ç³»çµ±é‡‘é¡ï¼š</strong><span style="font-size: 1.2rem; font-weight: bold; color: #1a5276;">${{ summary.total_amount|int }}</span></p>
            <p><strong>å·²é©—è­‰ï¼š</strong>{{ summary.verified_count }} ç­† (${{ summary.verified_amount|int }})</p>
            <p><strong>æœªé©—è­‰ï¼š</strong>{{ summary.unverified_count }} ç­† (${{ summary.unverified_amount|int }})</p>
        </div>

        {% if summary.unverified_count > 0 %}
        <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid #ffc107;">
            <p style="color: #856404;">
                âš ï¸ é‚„æœ‰ {{ summary.unverified_count }} ç­†æ”¶æ“šå°šæœªé©—è­‰ï¼Œå»ºè­°å…ˆå®Œæˆé©—è­‰å†å»ºç«‹ç¹³æ¬¾ç´€éŒ„ã€‚
            </p>
            <a href="{{ url_for('verify.operator_detail', operator_id=operator.id) }}" class="btn btn-warning" style="margin-top: 0.5rem;">å‰å¾€é©—è­‰</a>
        </div>
        {% endif %}

        <form method="POST">
            <div class="form-group">
                <label for="actual_amount">å¯¦éš›ç¹³æ¬¾é‡‘é¡ *</label>
                <input type="number" id="actual_amount" name="actual_amount" class="form-control"
                       required min="0" step="1" value="{{ summary.total_amount|int }}"
                       placeholder="è«‹è¼¸å…¥å¯¦éš›æ”¶åˆ°çš„ç¾é‡‘é‡‘é¡">
            </div>

            <div class="form-group">
                <label for="notes">å‚™è¨»</label>
                <textarea id="notes" name="notes" class="form-control" rows="3"
                          placeholder="å¦‚æœ‰å·®ç•°æˆ–ç‰¹æ®Šæƒ…æ³è«‹åœ¨æ­¤èªªæ˜"></textarea>
            </div>

            <div id="difference" style="display: none; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
            </div>

            <div class="d-flex gap-1">
                <button type="submit" class="btn btn-success">ç¢ºèªç¹³æ¬¾</button>
                <a href="{{ url_for('verify.index') }}" class="btn btn-secondary">å–æ¶ˆ</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const systemAmount = {{ summary.total_amount|int }};
    const actualInput = document.getElementById('actual_amount');
    const diffDiv = document.getElementById('difference');

    actualInput.addEventListener('input', function() {
        const actual = parseInt(this.value) || 0;
        const diff = actual - systemAmount;

        if (diff !== 0) {
            diffDiv.style.display = 'block';
            if (diff > 0) {
                diffDiv.style.backgroundColor = '#d4edda';
                diffDiv.innerHTML = '<strong>å·®ç•°ï¼š</strong>å¤šæ”¶ $' + diff + ' å…ƒ';
            } else {
                diffDiv.style.backgroundColor = '#f8d7da';
                diffDiv.innerHTML = '<strong>å·®ç•°ï¼š</strong>çŸ­å°‘ $' + Math.abs(diff) + ' å…ƒ';
            }
        } else {
            diffDiv.style.display = 'none';
        }
    });
});
</script>
{% endblock %}
