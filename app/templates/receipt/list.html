{% extends "base.html" %}

{% block title %}æ”¶æ“šæŸ¥è©¢{% endblock %}

{% block content %}
<div class="card">
    <div class="d-flex justify-between align-center">
        <h2 class="card-title" style="margin-bottom: 0;">ğŸ” æ”¶æ“šæŸ¥è©¢</h2>
        <form action="{{ url_for('receipt.search') }}" method="GET" class="d-flex gap-1">
            <input type="text" name="receipt_no" class="form-control" placeholder="è¼¸å…¥æ”¶æ“šç·¨è™Ÿ" style="width: 200px;">
            <button type="submit" class="btn btn-primary">æœå°‹</button>
        </form>
    </div>
</div>

<div class="card">
    {% if receipts.items %}
    <table class="table">
        <thead>
            <tr>
                <th>æ”¶æ“šç·¨è™Ÿ</th>
                <th>æ—¥æœŸæ™‚é–“</th>
                <th>æ”¶è²»é …ç›®</th>
                <th class="text-right">é‡‘é¡</th>
                <th>ç‹€æ…‹</th>
                <th>é©—è­‰</th>
                <th>ç¶“è¾¦å“¡</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for receipt in receipts.items %}
            <tr>
                <td>{{ receipt.receipt_no }}</td>
                <td>{{ receipt.created_at.strftime('%Y/%m/%d %H:%M') if receipt.created_at else '' }}</td>
                <td>{{ receipt.item_name }}</td>
                <td class="text-right">${{ receipt.amount|int }}</td>
                <td>
                    {% if receipt.status == 'active' %}
                    <span class="badge badge-success">æ­£å¸¸</span>
                    {% elif receipt.status == 'void_pending' %}
                    <span class="badge badge-warning">å¾…ä½œå»¢</span>
                    {% else %}
                    <span class="badge badge-danger">å·²ä½œå»¢</span>
                    {% endif %}
                </td>
                <td>
                    {% if receipt.is_verified %}
                    <span class="badge badge-success">å·²é©—è­‰</span>
                    {% else %}
                    <span class="badge badge-secondary">æœªé©—è­‰</span>
                    {% endif %}
                </td>
                <td>{{ receipt.operator_name }}</td>
                <td>
                    <a href="{{ url_for('receipt.view', receipt_id=receipt.id) }}" class="btn btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">æŸ¥çœ‹</a>
                    <a href="{{ url_for('receipt.print_receipt', receipt_id=receipt.id) }}" class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">åˆ—å°</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if receipts.pages > 1 %}
    <div class="pagination">
        {% if receipts.has_prev %}
        <a href="{{ url_for('receipt.index', page=receipts.prev_num) }}">ä¸Šä¸€é </a>
        {% endif %}

        {% for page in receipts.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page %}
                {% if page == receipts.page %}
                <span class="active">{{ page }}</span>
                {% else %}
                <a href="{{ url_for('receipt.index', page=page) }}">{{ page }}</a>
                {% endif %}
            {% else %}
            <span>...</span>
            {% endif %}
        {% endfor %}

        {% if receipts.has_next %}
        <a href="{{ url_for('receipt.index', page=receipts.next_num) }}">ä¸‹ä¸€é </a>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <p class="text-center" style="padding: 2rem; color: #666;">ç›®å‰æ²’æœ‰æ”¶æ“šè¨˜éŒ„</p>
    {% endif %}
</div>
{% endblock %}
