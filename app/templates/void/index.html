{% extends "base.html" %}

{% block title %}ä½œå»¢ç®¡ç†{% endblock %}

{% block content %}
<div class="card">
    <h2 class="card-title">âŒ ä½œå»¢ç®¡ç†</h2>
</div>

{% if current_user.can_approve_void() and pending_requests %}
<div class="card">
    <h3 style="margin-bottom: 1rem;">ğŸ”” å¾…å¯©æ ¸çš„ä½œå»¢ç”³è«‹ ({{ pending_requests|length }})</h3>
    <table class="table">
        <thead>
            <tr>
                <th>æ”¶æ“šç·¨è™Ÿ</th>
                <th>é‡‘é¡</th>
                <th>ç”³è«‹äºº</th>
                <th>ç”³è«‹æ™‚é–“</th>
                <th>åŸå› </th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for req in pending_requests %}
            <tr>
                <td>
                    <a href="{{ url_for('receipt.view', receipt_id=req.receipt_id) }}">
                        {{ req.receipt.receipt_no }}
                    </a>
                </td>
                <td>${{ req.receipt.amount|int }}</td>
                <td>{{ req.requester.full_name }}</td>
                <td>{{ req.requested_at.strftime('%m/%d %H:%M') if req.requested_at else '' }}</td>
                <td>{{ req.reason[:30] }}{% if req.reason|length > 30 %}...{% endif %}</td>
                <td>
                    <a href="{{ url_for('void.review', request_id=req.id) }}" class="btn btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">å¯©æ ¸</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<div class="card">
    <div class="d-flex justify-between align-center mb-2">
        <h3>æˆ‘çš„ä½œå»¢ç”³è«‹</h3>
        <a href="{{ url_for('void.history') }}" class="btn btn-secondary">æŸ¥çœ‹å…¨éƒ¨æ­·å²</a>
    </div>

    {% if my_requests %}
    <table class="table">
        <thead>
            <tr>
                <th>æ”¶æ“šç·¨è™Ÿ</th>
                <th>é‡‘é¡</th>
                <th>ç”³è«‹æ™‚é–“</th>
                <th>åŸå› </th>
                <th>ç‹€æ…‹</th>
            </tr>
        </thead>
        <tbody>
            {% for req in my_requests %}
            <tr>
                <td>
                    <a href="{{ url_for('receipt.view', receipt_id=req.receipt_id) }}">
                        {{ req.receipt.receipt_no }}
                    </a>
                </td>
                <td>${{ req.receipt.amount|int }}</td>
                <td>{{ req.requested_at.strftime('%m/%d %H:%M') if req.requested_at else '' }}</td>
                <td>{{ req.reason[:30] }}{% if req.reason|length > 30 %}...{% endif %}</td>
                <td>
                    {% if req.status == 'pending' %}
                    <span class="badge badge-warning">å¾…å¯©æ ¸</span>
                    {% elif req.status == 'approved' %}
                    <span class="badge badge-success">å·²æ ¸å‡†</span>
                    {% else %}
                    <span class="badge badge-danger">å·²é§å›</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-center" style="padding: 2rem; color: #666;">æ‚¨ç›®å‰æ²’æœ‰ä½œå»¢ç”³è«‹</p>
    {% endif %}
</div>
{% endblock %}
